import{BG_ as e,bgSettings_ as s,$$ as l,asyncBackend_ as c}from"./async_bg.js";import{Option_ as a,oTrans_ as m}from"./options_base.js";import{loadChecker as g}from"./options_wnd.js";let p={Ke:0,Us:null,Fr(){function t(t,e,s){let r="";s.length>2&&":"===s[s.length-2]&&(r=s.slice(-2),s=s.slice(0,-2));let n=e.toLowerCase(),i=s.length>1,l=n.includes("s-"),o=s.toUpperCase();if(!i){if(!n)return t;if(l&&n.length<3)return r?`<${o}${r}>`:o}let c=s.toLowerCase();var a;return n=n.includes("v-")?"v-":(a=n).length<4?a:a.slice(0,-1).split("-").sort().join("-")+"-",s!==c&&!l&&(n+="s-"),n||i||r?`<${n}${c}${r}>`:s}this.Us=e=>e.replace(/<(?!<)((?:[ACMSVacmsv]-){0,4})(.[^>]*)>/g,t),this.js=this.js.bind(this),this.Ls=this.Ls.bind(this),this.Hs=this.Hs.bind(this),this.Fr=null},Vs:(t,e)=>e?"\\u00"+e:"\\\\",Hs(t,e,s,r){s?e=`"${s=s.replace(/\\(?:x([\da-z]{2})|\\)/gi,this.Vs)}"`:r||"\\\\"!==e||(e="\\");let n="";e.startsWith("{")&&(n=e=e.replace(/([{,] ?)(\w+):/g,'$1"$2":'));try{let s=JSON.parse(e.includes("\\\r")?e.replace(/\\\r/g," "):e);if("string"!=typeof s)return true!==s?n?"="+n+r:t:"";e=s}catch(t){s&&(e=s)}return"="+(e=(e=e&&e.replace(/\\(\\|s)/g,(t,e)=>"s"===e?" ":t))&&JSON.stringify(e).replace(/\s/g,this.Bs))+r},Bs:t=>"\\u"+(t.charCodeAt(0)+1048576).toString(16).slice(2),js(t,e,s,r){let n=this.Us(s);if(n!==s&&(console.log("KeyMappings Checker:",s,"is corrected into",n),s=n),"mapkey"===e.replace("#","").trim().toLowerCase()){let t=r.match(/^\s*\S+/),e=t&&t[0].trim(),s=e&&this.Us(e);s!==e&&(console.log("KeyMappings Checker:",e,"is corrected into",s),r=r.replace(e,s))}return this.Ls("",e,s,r)},qs:(t,e,s)=>e.replace("map","mapKey")+(3===s.length?s[1]:s),Ls(t,e,s,r){return(r.includes("createTab")||r.includes("openUrl"))&&/^\s+(createTab|openUrl)\s/.test(r)&&!/\surls?=/i.test(r)&&(r=this.Gs(r)),e+s+(r?r.replace(/=("(\S*(?:\s[^=]*)?)"|[\S\r]+)(\s|$)/g,this.Hs):"")},Gs(t){let e=[];t=(t+" ").replace(/\s(\w+:[^=\s]+|[^\s=]+:\/\/\S+)(?=\s|$)/g,(t,s)=>(e.push(s),"")).trimRight();let s=e.length;return t+(s>1?" urls=":s?" url=":"")+(s?JSON.stringify(s>1?e:e[0]):"")},_s(t){return t?(this.Fr&&this.Fr(),t=(t=(t=(t=(t=t.replace(/\\\\?\n/g,t=>3===t.length?t:"\\\r")).replace(/^([ \t]*(?:#\s?)?map\s+(?:<(?!<)(?:.-){0,4}.[\w:]*?>|\S)\s+)(<(?!<)(?:[ACMSVacmsv]-){0,4}.\w*?>)(?=\s|$)/gm,this.qs)).replace(/^([ \t]*(?:#\s?)?(?:un)?map(?:[kK]ey)?\s+)(\S+)([^\n]*)/gm,this.js)).replace(/^([ \t]*(?:#\s?)?(?:command|shortcut)\s+)(\S+)([^\n]*)/gm,this.Ls)).replace(/\\\r/g,"\\\n").trim()):t}};a.Is.keyMappings.cs=p,p=null,a.Is.searchUrl.cs={Ke:0,_s(t){let s=new e.Map,r=a.Is.searchUrl;c.Ul("k:"+t,s);let n=s.get("k");if(null==n)return r.rs();let i=c.yt(n.Ot,null,-2);if(c.kt()>2){let t=m("nonPlainURL",[n.Ot]);return console.log("searchUrl checker:",t),r.Qs(t),r.rs()}return i=i.replace(/\s+/g,"%20"),n.Nl&&"k"!==n.Nl&&(i+=" "+n.Nl),r.Qs(""),i}},a.Is.vimSync.fs=function(){if(!this.ns&&true===this.ms()){let t=a.Is,e=0;for(let s in t)t[s].ns||++e;let s=e>1;if(setTimeout(alert,100,m(s?"changedBeforeSync":"warningForSync")),s)return false}return true},a.Is.keyboard.cs={Ke:0,_s:t=>null!=t&&2===t.length&&t[0]>0&&t[0]<4e3&&t[1]>0&&t[1]<1e3?[+t[0],t[1]]:s.Ft.keyboard};for(let t of l("[data-check]"))t.removeEventListener(t.dataset.check||"input",g);