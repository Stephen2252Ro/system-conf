function Ve(){function t(){let e=a.Is;for(let t in e){let n=e[t],{ss:o}=n;"object"==typeof o&&o&&(n.ss=n.rs())}}e.removeEventListener("unload",Ve,{capture:false}),setTimeout(()=>{if(Ce(),!e)return window.onbeforeunload=null,void window.close();e.addEventListener("unload",Ve),"loading"===e.document.readyState?e.addEventListener("DOMContentLoaded",()=>{setTimeout(t,100)},{capture:true,once:true}):setTimeout(t,67)},200)}import{CurCVer_ as t,CurFFVer_ as j,BG_ as e,bgSettings_ as s,reloadBG_ as Ce,OnFirefox as f,OnChrome as i,OnEdge as k,$ as n,$$ as l,toggleDark as Me,toggleReduceMotion as He,asyncBackend_ as c,browser_ as _,enableNextTick_ as te,nextTick_ as h,IsEdg_ as q,import2 as T}from"./async_bg.js";import{showI18n as oe,setupBorderWidth_ as le,Option_ as a,debounce_ as De,oTrans_ as m}from"./options_base.js";import{saveBtn as Be,exportBtn as Fe,savedStatus as We,BooleanOption_ as qe}from"./options_defs.js";export let Platform_;export let delayed_task;export const clear_delayed_task=()=>{delayed_task=null};_.runtime.getPlatformInfo(e=>{Platform_=e.os.toLowerCase(),te(1)}),h(oe),le&&h(le),h(e=>{let t=_.runtime.getManifest();e.textContent=t.version_name||t.version},n(".version")),Be.onclick=function(e){if(false!==e&&!a.Ws())return;let t=a.Ss;a.Ss=[],this.disabled=true,this.firstChild.data=m("o115_3"),Fe.disabled=false,We(false),window.onbeforeunload=null,0!==t.length&&setTimeout(e=>{s.Pt({N:6,d:e.map(e=>s.Lt[e])})},100,t)};let Ge=function(){let e,o=false,i=n("#advancedOptionsButton");i.onclick=function(e,t){let i=n("#advancedOptions"),l=null,r=()=>l=s.Nt("showAdvancedOptions");null==t||"hash"===t&&false===r()?(o=!o,s.Rt("showAdvancedOptions",o)):o=null!=l?l:r(),h(()=>{i.previousElementSibling.style.display=i.style.display=o?"":"none";let e=o?"Hide":"Show";this.firstChild.data=m(e)||e,this.setAttribute("aria-checked",""+o)},9)},i.onclick(null,true);for(let e in a.Is)a.Is[e].os();h(()=>{for(let e in a.Is){let t=a.Is[e];t.as(t.ss)}}),a.Is.exclusionRules.ss.length>0&&h(e=>{e.style.visibility=""},n("#exclusionToolbar")),e=l("[data-check]");for(let t=e.length;0<=--t;)i=e[t],i.addEventListener(i.dataset.check||"input",loadChecker);document.addEventListener("keyup",e=>{let t=e.target,n=e.keyCode;if(13===n){if(t instanceof HTMLAnchorElement)t.hasAttribute("href")||setTimeout(e=>{click(e),e.blur()},0,t);else if((e.ctrlKey||e.metaKey)&&(t.blur&&t.blur(),We()))return Be.onclick()}else{if(32!==n)return;t instanceof HTMLSpanElement&&t.parentElement instanceof HTMLLabelElement&&(e.preventDefault(),click(t.parentElement.control))}});let r=function(){let e=n("#"+this.dataset.autoResize),t=e.scrollHeight,o=e.scrollWidth,i=o-e.clientWidth;if(t<=e.clientHeight&&i<=0)return;let l=Math.max(Math.min(innerWidth,1024)-120,550);e.style.maxWidth=o>l?l+"px":"",e.style.height=e.style.width="",i=o-e.clientWidth;let r=e.offsetHeight-e.clientHeight;r=i>0?Math.max(26,r):r+18,t+=r,i>0&&(e.style.width=e.offsetWidth+i+4+"px"),e.style.height=t+"px"};e=l("[data-auto-resize]");for(let t=e.length;0<=--t;)e[t].onclick=r;r=function(e){let t=this.dataset.delay,n=null;"continue"!==t&&e&&e.preventDefault(),"event"===t&&(n=e||null),delayed_task=["#"+this.id,n],"complete"!==document.readyState?window.addEventListener("load",function e(t){t.target===document&&(window.removeEventListener("load",e),T("./options_ext.js"))}):T("./options_ext.js")},e=l("[data-delay]");for(let t=e.length;0<=--t;)e[t].onclick=r;e=l("[data-permission]"),e.length>0&&(e=>{function n(){let e=this.querySelector("[data-permission]");if(this.onclick=null,!e)return;let t=e.dataset.permission;e.placeholder=m("lackPermission",[t?`: "${t}"`:""])}let o=_.runtime.getManifest();for(let e of o.permissions||[])o[e]=true;for(let i=e.length;0<=--i;){let l=e[i],r=l.dataset.permission;if("C"===r[0]){if(t>=+r.slice(1))continue;r=m("beforeChromium",[r.slice(1)])}else{if(r in o)continue;r=m("lackPermission",[r?":\n* "+r:""])}r=m("invalidOption",[r]),h(e=>{e.disabled=true,e instanceof HTMLInputElement&&"checkbox"===e.type?(e.nextElementSibling.tabIndex=-1,(e=e.parentElement).title=r):(e.value="",e.title=r,e.parentElement.onclick=n)},l)}})(e),h(()=>{setTimeout(()=>{let e=l("[data-href]");for(let t=e.length;0<=--t;){let n=e[t],o=c.yt(n.dataset.href,null,-1);n.removeAttribute("data-href"),n.setAttribute("href",o)}},100)}),i=n("#openExtensionsPage"),i.onclick=function(e){e.preventDefault(),c.dn({u:this.href,p:true})},h(e=>{let t=e.children[1],n=m("NewTabAdapter");t.title=n+" - "+m("webstore")},n("#chromeExtVomnibar")),e=l(".ref-text");let u=function(e){o||n("#advancedOptionsButton").onclick(null),e.preventDefault();let t=a.Is[this.getAttribute("for")].ts.nextElementSibling;t.scrollIntoView({block:"center"}),t.focus(),window.VApi&&VApi.x(t.parentElement.parentElement)};for(let t=e.length;0<=--t;){let o=a.Is[e[t].getAttribute("for")],i=o.hs;o.hs=()=>{i.call(o),h(e=>{e.textContent=m(o.ms()>1?"o145_2":"o144")},n(`#${o.ts.id}Status`))},e[t].onclick=u,o.ts.addEventListener("change",o.hs,true)}},Je=function(){a.us=false,Ge(),Ge=Je=null;for(let e in a.Is)a.Is[e].hs();let e=a.Is.newTabUrl;e.cs._s(e.ss),c.Ye.o||h(e=>{e.textContent="Cmd"},n("#Ctrl")),window.onhashchange();{let e=matchMedia("(prefers-color-scheme: dark)");e.onchange=()=>{c.ao(),setTimeout(t,34)};let t=n=>{let o=a.Is.autoDarkMode;if(o.ss&&o.ns){let o=e.matches;if(window.VApi&&VApi.z){let e=VApi.y().r;if(e)for(let t of e.children)if("style"!==t.localName&&(t.classList.toggle("D",o),t=t.firstElementChild||t,"iframe"===t.localName)){let e=t.classList.contains("Find"),n=t.contentDocument,i=n.querySelector("style#dark");if(i&&i.sheet&&(i.sheet.disabled=!o),n.body.classList.toggle(e?"D":"has-dark",o),e){let e=VApi.y().f;e&&e.parentElement.classList.toggle("D",o)}}s.Et("d",o,VApi.z)}else 1===n&&o!==!!c.Ye.d&&setTimeout(t,500);Me(o)}};t(1)}a.Is.autoDarkMode.hs=function(){c.ao(),Me(this.ss)},a.Is.autoReduceMotion.hs=function(){He(this.ss)}};a.Is.userDefinedCss.ts.addEventListener("input",De(()=>{let t=a.Is.userDefinedCss,n=t.ts.classList.contains("debugging");if(t.ns&&!n||!window.VApi||!VApi.z)return;let o=t.ms(),i=o===t.ss,l=c.nn(-1,o),r=VApi.y().r;!n&&e&&_.tabs.query({currentWindow:true,active:true},e=>{if(e&&e[0]&&e[0].url===location.href){let t=c.no(e[0].id,0);t&&(t.s.Zt|=40)}}),t.ts.classList.toggle("debugging",!i),VApi.t({k:r||i?0:1,t:"Debugging CSS\u2026",H:l.ui,f:l.find});let s=r&&r.querySelector("iframe.Omnibar"),u=s&&s.contentDocument;if(u){let e=u.querySelector("style.debugged")||u.querySelector("style#custom");e||((e=u.createElement("style")).type="text/css",e.id="custom"),e.parentNode||u.head.append(e),e.classList.add("debugged"),e.textContent=(i?"\n":"\n.transparent { opacity: 1; }\n")+(l.omni&&l.omni+"\n"||"")}},1200,null,0)),n("#importButton").onclick=()=>{let e=n("#importOptions");e.onchange?e.onchange(null):click(n("#settingsFile"))},h(e=>{if(e.textContent=(q?["MS Edge"]:/\bChromium\b/.exec(navigator.appVersion)||["Chrome"])[0]+" "+t+m("comma")+m("NS")+(m(Platform_)||Platform_[0].toUpperCase()+Platform_.slice(1)),q){let e=n("#openExtensionsPage");e.textContent=e.href="edge://extensions/shortcuts"}},n("#browserName"));export const loadChecker=()=>{T("./options_checker.js")};document.addEventListener("keydown",e=>{if(32!==e.keyCode){if(!window.VApi||!VApi.z||"input textarea".includes(document.activeElement.localName))return;let t=VApi.m({c:" ",e,i:e.keyCode},9);if("a-f12"===t){let e=n("#importOptions"),t=e.selectedIndex,o=()=>{e.onchange&&e.onchange(null),e.selectedIndex=t};n("#recommendedSettings").selected=true,null!=e.onchange?o():setTimeout(o,100)&&e.click()}else"?"===t&&n("#showCommands").click();return}let t=e.target;"span"===t.localName&&"label"===t.parentElement.localName&&e.preventDefault()}),window.onhashchange=()=>{let e,t=location.hash;t=t.slice("!"===t[1]?2:1),t&&/^[a-z][a-z\d_-]*$/i.test(t)&&((e=n(`[data-hash="${t}"]`))?e.onclick&&h(()=>{e.onclick(null,"hash")}):(e=n("#"+t))&&h(()=>{e.dataset.model&&e.classList.add("highlight");let t=t=>{t&&t.target!==window||(window.onload&&(window.onload=null,window.scrollTo(0,0)),e.scrollIntoViewIfNeeded())};if("complete"===document.readyState)return t();window.scrollTo(0,0),window.onload=t}))},c.O()&&c.O()?c.O().then(Je):Je(),window.onunload=()=>{e.removeEventListener("unload",Ve)},e.addEventListener("unload",Ve,{capture:false,once:true});let Ke=c.to().pe.get("?");if(!Ke||7!==Ke.Ta){let e="";c.to().pe.forEach((t,n)=>{7===t.Ta&&(e=e&&e.length<n.length?e:n)}),e&&h(([e,t])=>e.textContent=t,[n("#questionShortcut"),e])}document.addEventListener("click",function e(){let t=window.VApi,n=t&&t.y();n&&n.r&&(document.removeEventListener("click",e,true),n.r.addEventListener("click",e=>{let t,n=e.target;VApi&&n.classList.contains("HelpCommandName")&&(t=n.textContent.slice(1,-1),VApi.p({H:16,s:t}))},true),document.addEventListener("click",e=>{if("a"!==e.target.localName||!(e.ctrlKey||e.metaKey))return;let t=window.VApi,n=t&&t.b,o=n&&n.$();if(o&&o.b&&!o.a){let e=-17&o.m;if(e<32&&2&e&&!(1&e)){let e=c.so();e>=0&&setTimeout(()=>{_.tabs.update(e,{active:true})},0)}}}))},true);export const click=e=>{let t=document.createEvent("MouseEvents");return t.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null),e.dispatchEvent(t)};