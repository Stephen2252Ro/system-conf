"use strict";__filename="background/normalize_urls.js",define(["require","exports","./store","./utils"],(e,t,r,l)=>{Object.defineProperty(t,"__esModule",{value:true}),t.$t=t._t=t.zt=t.vt=t.xt=t.yt=t.kt=t.jt=t.St=t.qt=t.At=t.It=void 0,t.It=/^([^:]+(:[^:]+)?@)?([^:]+|\[[^\]]+])(:\d{2,5})?$/,t.At=/^(?:ext|web)\+[a-z]+:/,t.qt=/^"[^"]*"$|^'[^']*'$|^\u201c[^\u201d]*\u201d$/,t.St=/\$([sS])(?:\{([^}]*)})?/g,t.jt=/\$([+-]?\d+)/g,t.kt=0,t.yt=(e,s,a)=>{if(e=e.trim(),t.kt=0,l.lt(e))return e=e.replace(/\xa0/g," "),l.bt(),e;let o,f,m,c,d=-1,w=0,b=false;m=e.replace(/[\n\r]+[\t \xa0]*/g,"").replace(/\xa0/g," ");let p='"'===m[0]&&m.endsWith('"'),$=m;return e=m=p?m.slice(1,-1):m,/^[A-Za-z]:(?:[\\/][^:*?"<>|]*)?$|^\/(?:Users|home|root)\/[^:*?"<>|]+$/.test(e)?(":"===e[1]&&(e=e[0].toUpperCase()+":/"+e.slice(3).replace(/\\/g,"/")),l.bt(),"file://"+("/"===e[0]?e:"/"+e)):e.startsWith("\\\\")&&e.length>3?((e=e.slice(2).replace(/\\/g,"/")).lastIndexOf("/")<=0&&(e+="/"),l.bt(),"file://"+e):((o=(e=m.toLowerCase()).indexOf(" ")+1||e.indexOf("\t")+1)>1&&(e=e.slice(0,o-1)),0===(o=e.indexOf(":"))?d=4:-1!==o&&l.gt.test(e)?e.startsWith("vimium:")?(d=3,a|=0,e=m.slice(9),a<-1||!e?m="vimium://"+e:-1===a||p||!(m=r.P(e,a))?m=t.vt(e,false,a):"string"!=typeof m&&(d=5)):t.At.test(e)?d=0:(-1===(f=e.indexOf("/",o+3))?e.length<m.length:e.charCodeAt(f+1)<33)?d=4:/[^a-z]/.test(e.slice(0,o))?d=(o=e.charCodeAt(o+3))>32&&47!==o?0:4:e.startsWith("file:")?d=0:e.startsWith("chrome:")?d=e.length<m.length&&e.includes("/")?4:0:r.He&&e.startsWith("read:")?d=!/^read:\/\/([a-z]+)_([.\da-z\-]+)(?:_(\d+))?\/\?url=\1%3a%2f%2f\2(%3a\3)?(%2f|$)/.test(e)||e.length<m.length?4:0:e=e.slice(o+3,f>=0?f:void 0):(-1!==o&&e.lastIndexOf("/",o)<0&&(d=n(m.toLowerCase(),o,e.length%m.length)),w=2,f=m.length,-1===d&&e.startsWith("//")&&(e=e.slice(2),w=1,f-=2),-1!==d?"about:blank/"===e&&(m="about:blank"):(o=e.indexOf("/"))<=0?(0===o||e.length<f)&&(d=4):e.length>=f||e.charCodeAt(o+1)>32?(b=e.length>o+1,e=e.slice(0,o)):d=4),-1===d&&e.lastIndexOf("%")>=0&&(e=l.tt(e)).includes("/")&&(d=4),-1===d&&e.startsWith(".")&&(e=e.slice(1)),-1!==d||((c=t.It.exec(e))?(e=c[3]).endsWith("]")?d=l.at(e,6)?w:4:"localhost"===e||e.endsWith(".localhost")||l.at(e,4)||c[4]&&b?d=w:(o=e.lastIndexOf("."))<0||0===(d=l.rt(e.slice(o+1)))?(o<0&&"__proto__"===e&&(e="."+e),f=e.length-o-1,d=2!==w&&(o<0||f>=3&&f<=5)||u(e,c[4])>0?w:4):d=/[^.\da-z\-]|xn--|^-/.test(e)?e.startsWith("xn--")||e.includes(".xn--")||(e.length===o+3||1!==d?!w:u(e,c[4]))?w:4:2!==w||b?w:e.endsWith(".so")&&e.startsWith("lib")&&e.indexOf(".")===e.length-3?4:c[2]||c[4]||!c[1]||/^ftps?(\b|_)/.test(e)?2:e.startsWith("mail")||e.indexOf(".mail")>0||(f=e.indexOf("."))===o?4:e.indexOf(".",++f)!==o?2:e.length===o+3&&1===d&&l.rt(e.slice(f,o),true)?4:2:(d=4,e.length===m.length&&l.at(e=`[${e}]`,6)&&(m=e,d=2))),l.bt(),t.kt=d,0===d?/^extension:\/\//i.test(m)?"chrome-"+m:m:4===d?t.zt($.split(l.ft),s||"~",a):d<=2?2===d&&i(m,e)||(2===u(e,c&&c[4])?"https:":"http:")+(2===d?"//":"")+m:m)};let u=(e,t)=>{let l=t&&r.ue.Xe.get(e+t)||r.ue.Xe.get(e);return l?l.Mt?2:1:0},i=(e,t)=>{if(/^(?!www\.)[a-z\d-]+\.([a-z]{3}(\.[a-z]{2})?|[a-z]{2})\/?$/i.test(e)&&!u(t)){let l=r.ue.Xe.get("www."+t);if(l)return`${l.Mt?"https":"http"}://www.${e.toLowerCase().replace("/","")}/`}return""},n=(e,r,u)=>{let i="/"===e.substr(r+1,1);switch(e.slice(0,r)){case"about":return i?4:u>0||e.includes("@",r)?-1:0;case"blob":case"view-source":return(e=e.slice(r+1)).startsWith("blob:")||e.startsWith("view-source:")?4:(t.yt(e,null,-2),t.kt<=2?0:4);case"data":return i?4:(r=e.indexOf(",",r))<0||u>0&&u<r?-1:0;case"file":return 0;case"filesystem":return e=e.slice(r+1),l.gt.test(e)?(t.yt(e,null,-2),0===t.kt&&/[^/]\/(?:persistent|temporary)(?:\/|$)/.test(e)?0:4):4;case"magnet":return"?"!==e[r+1]?-1:0;case"mailto":return i?4:(r=e.indexOf("/",r))>0&&e.lastIndexOf("?",r)<0?-1:0;case"tel":return/\d/.test(e)?0:4;default:return t.At.test(e)?0:i?4:-1}};t.xt=e=>{let t=e.startsWith("filesystem:")?11:e.startsWith("view-source:")?12:0;return t?e.slice(t):e},t.vt=(e,t,l)=>{let u,i,n="",s="",a=e.trim();if(!a)return t?"":location.origin+"/pages/";if((u=a.indexOf(" ")+1)&&(s=a.slice(u).trim(),a=a.slice(0,u-1)),(u=a.search(/[\/#?]/)+1)&&(n=a.slice(u-1).trim(),a=a.slice(0,u-1)),"display"===a&&(a="show"),!/\.\w+$/.test(a))if(a=a.toLowerCase(),null!=(i=r.e.wl[a]))i=a=i&&"/"!==i[0]&&"#"!==i[0]?i:r.e.gl+(i.includes(".")?"/blob/master"+i:i);else{if("newtab"===a)return r.Te.newTabUrl_f;if("/"===a[0]||r.e.ml.indexOf(a)>=0)a+=".html";else{if(1===l||-1===l)return"vimium://"+e.trim();a="show.html#!url vimium://"+a}}return t||i&&i.includes("://")||(a=location.origin+("/"===a[0]?"":"/pages/")+a),n&&(a+=n),a+(s&&(a.includes("#")?" ":"#!")+s)},t.zt=(e,l,u)=>{let i,n=r.Te.searchEngineMap.get(l||e[0]);return n?(l||(l=e.shift()),i=t._t(e,n.Ot,n.A)):i=e.join(" "),"~"!==l?t.yt(i,null,u):(t.kt=4,i)},t._t=(e,r,u,i)=>{let n,s=0;return r=0===e.length&&u?u:r.replace(t.St,(u,a,o,f)=>{let m;return"S"===a?(m=e,a=" "):(m=n||(n=e.map(l.g)),a=l.lt(r)?"%20":"+"),0===m.length?"":(o=o&&o.includes("$")?o.replace(t.jt,(e,t)=>{let r=parseInt(t,10);if(!r)return m.join(a);if(r<0)r+=m.length+1;else if("+"===t[0])return m.slice(r-1).join(a);return m[r-1]||""}):m.join(null!=o?o:a),null!=i&&(i.push(f+=s,f+o.length),s+=o.length-u.length),o)}),l.bt(),null==i?r:{Ot:r,Ut:i}},t.$t=e=>{let r=e.indexOf(":"),l=r;if(r<=0)return e;if(t.At.test(e.slice(0,r+1).toLowerCase()))return e.slice(0,r).toLowerCase()+e.slice(r);if("://"===e.substr(r,3))if(r=e.indexOf("/",r+3),r<0)r=l,l=-1;else if(7===r&&"file"===e.slice(0,4).toLowerCase())return r=":"===e.substr(9,1)?3:0,"file:///"+(r?e[8].toUpperCase()+":/":"")+e.slice(r+8);let u=e.slice(0,r),i=u.toLowerCase();return-1===l&&/^(file|ftp|https?|rt[ms]p|wss?)$/.test(u)&&(e+="/"),u!==i?i+e.slice(r):e}});