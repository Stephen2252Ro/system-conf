"use strict";__filename="background/exclusions.js",define(["require","exports","./store","./utils","./browser","./normalize_urls","./settings","./ports"],(e,t,l,i,r,n,u,o)=>{Object.defineProperty(t,"__esModule",{value:true}),t.ei=t.ti=t.li=t.Yt=t.ii=t.rr=t.Xt=t.ri=t.ni=t.ui=void 0,i=__importStar(i),u=__importStar(u),t.ui=(e,t)=>{let l,r;return t=t&&t.replace(/<(\S+)>/g,"$1"),"^"===e[0]&&((l=i.l(e.startsWith("^$|")?e.slice(3):e,"",0))||console.log("Failed in creating an RegExp from %o",e)),r=l?{t:1,v:l,k:t}:{t:2,v:e.startsWith(":vimium://")?n.vt(e.slice(10),false,-1):e.slice(1),k:t},r},t.ni=e=>{let t;if("^"===e[0]){e=e.startsWith("^$|")?e.slice(3):e,t=".*$".includes(e.slice(-2))?e.endsWith(".*$")?3:e.endsWith(".*")?2:0:0,e=0!==t&&"\\"!==e[e.length-t]?e.slice(0,-t):e;let l=i.l(e,"");return l?{t:1,v:l}:null}if("localhost"===e||!e.includes("/")&&e.includes(".")&&(!/:(?!\d+$)/.test(e)||i.at(e,6))){let t;e=(e=(e=e.toLowerCase()).endsWith("*")?e.slice(0,/^[^\\]\.\*$/.test(e.slice(-3))?-2:-1):e).startsWith(".*")&&!/[(\\[]/.test(e)?"*."+e.slice(2):e;let l=i.l("^https?://"+(e.startsWith("*")&&"."!==e[1]?"[^/]"+e:(t=e.replace(/\./g,"\\."),t.startsWith("*")?t.replace("*\\.","(?:[^./]+\\.)*?"):t)),"",0);return l?{t:1,v:l}:e.includes("*")?null:{t:2,v:"https://"+(e.startsWith(".")?e.slice(1):e)+"/"}}return t=(e=(e=(":"===e[0]?e.slice(1):e).replace(/([\/?#])\*$/,"$1")).startsWith("vimium://")?n.vt(e.slice(9),false,-1):e).indexOf("://"),{t:2,v:t>0&&e.indexOf("/",t+3)<0?e+"/":e}},t.ri=(e,t)=>2===e.t?t.startsWith(e.v):e.v.test(t);let s=false;t.Xt=s;let f,a=false;t.rr=a;let v=[],c=e=>{if(0===e.length)return v=[],void t.ei();v=e.map(e=>t.ui(e.pattern,e.passKeys)),t.ei()};t.ii=e=>(e?[t.ui(e,"")]:v).map(e=>({t:e.t,v:2===e.t?e.v:e.v.source})),t.Yt=(e,r)=>{var n;let u="";for(let t of v)if(2===t.t?e.startsWith(t.v):t.v.test(e)){let e=t.k;if(0===e.length||"^"===e[0]&&e.length>2||f)return e&&e.trim();u+=e}if(!u&&r.Yl&&e.lastIndexOf("://",5)<0&&!i.gt.test(e)){let e=null===(n=l.Pe.get(r.Xl))||void 0===n?void 0:n.lr;if(null!=e)return t.Yt(e.s.Ot,e.s)}return u?u.trim():null};let d=()=>{let e=r.Ml()&&r.Ml().onHistoryStateUpdated?e=>{l.ie[8](e)}:null;return d=()=>e,e};t.li=()=>{let e=i.ct(),t=0;for(let{k:l}of v)if(l){if("^"===l[0]&&l.length>2)return true;for(let i of l.split(" "))e[i]=1,t++}return t?e:null},t.ti=e=>{let i=v.length>0?null:{N:1,p:null,f:0};if(e)return void(i||u.Pt({N:3,H:8}));let r=null!=l.Re||void 0!==l.Re&&u.Nt("showActionIcon"),n=v;o.Kt(e=>{let n=e.er.s.Ke,u=e.er.s;for(let l of e.Qt){let r=null,n=0;if(i){if(0===l.s.Ke)continue}else if(r=t.Yt(l.s.Ot,l.s),n=null===r?0:r?1:2,!r&&l.s.Ke===n)continue;e.Zl||(l.postMessage(i||{N:1,p:r,f:0}),l.s.Ke=n)}r&&n!==u.Ke&&l.L(u.Xl,u.Ke)},()=>n===v)},t.ei=()=>{let e=v.length>0,l=d(),i=e&&u.Nt("exclusionListenHash");if(l){if(s!==e){t.Xt=s=e;let i=r.Ml().onHistoryStateUpdated;e?i.addListener(l):i.removeListener(l),s&&(f=u.Nt("exclusionOnlyFirstMatch"))}if(a!==i){t.rr=a=i;let e=r.Ml().onReferenceFragmentUpdated;i?e.addListener(l):e.removeListener(l)}}},u.Ct.exclusionRules=e=>{let i=!v.length,r=l.me;c(e),setTimeout(()=>{setTimeout(t.ti,10,i),l.me===r&&u.Dt("keyMappings",null)},1)},u.Ct.exclusionOnlyFirstMatch=e=>{f=e},u.Ct.exclusionListenHash=t.ei,"[]"!==u.Jt.getItem("exclusionRules")&&c(u.Nt("exclusionRules"))});