"use strict";__filename="background/browser.js",define(["require","exports","./store","./utils"],(e,l,t,r)=>{Object.defineProperty(l,"__esModule",{value:true}),l.vl=l.Il=l.xl=l.removeTempTab=l.downloadFile=l.makeTempWindow_r=l.makeWindow=l.openMultiTabs=l.tabsCreate=l.selectWndIfNeed=l.selectWnd=l.selectTab=l.yl=l.kl=l.zl=l.selectFrom=l.getCurWnd=l.jl=l.Wl=l.ql=l.getCurTabs=l.getCurTab=l.isTabMuted=l.getTabUrl=l.getGroupId=l.tabsUpdate=l.tabsGet=l.Fl=l.Ml=l.Ol=l.Pl=l.$l=l.Al=void 0,l.Al=chrome,l.$l=l.Al.tabs,l.Pl=l.Al.windows,l.Ol=()=>l.Al.sessions,l.Ml=()=>l.Al.webNavigation,l.Fl=()=>l.Al.runtime.lastError,l.tabsGet=l.$l.get,l.tabsUpdate=l.$l.update,l.getGroupId=e=>{let l=e.groupId;return-1!==l&&null!=l?l:null},l.getTabUrl=e=>e.url||e.pendingUrl,l.isTabMuted=e=>e.mutedInfo.muted,l.getCurTab=l.$l.query.bind(null,{active:true,currentWindow:true}),l.getCurTabs=l.$l.query.bind(null,{currentWindow:true}),l.ql=l.getCurTabs,l.Wl=()=>true,l.jl=null,l.getCurWnd=(e,r)=>{let u={populate:e};t.Se>=0?l.Pl.get(t.Se,u,r):l.Pl.getCurrent(u,r)},l.selectFrom=e=>{for(let l=e.length;0<--l;)if(e[l].active)return e[l];return e[0]},l.zl=e=>/^(edge-)?extension:/.test(e)?t.e.ll+"-"+e.slice(e.indexOf("ext")):e,l.kl=function(e){let t=[].slice.call(arguments,1),{wt:u,ht:o}=r.c();return t.push(e=>{let t=l.Fl();return o(t?void 0:null!=e?e:null),t}),e.apply(void 0,t),u},l.yl=e=>e!==t.A?()=>{let t=l.Fl();return e(!t),t}:l.Fl;let u=(e,l)=>{let r=t.ve.get(e);return 1===r||2===r&&!(!t.He&&!l)};l.selectTab=(e,t)=>{l.tabsUpdate(e,{active:true},t)},l.selectWnd=e=>(e&&l.Pl.update(e.windowId,{focused:true}),l.Fl()),l.selectWndIfNeed=e=>{e.windowId!==t.Se&&l.selectWnd(e)},l.tabsCreate=(e,r,o)=>{let{url:n}=e;n?u(n,2===t.we)&&delete e.url:(n=t.Te.newTabUrl_f,2===t.we&&(-1===o?n.endsWith(t.e.al)&&n.startsWith(location.origin):!o&&n.startsWith(location.protocol))||u(n,2===t.we)||(e.url=n),e.url||delete e.url),l.$l.create(e,r)},l.openMultiTabs=(e,t,r,u,o,n,i)=>{let s;o=false!==o,s=null!=n?l.getGroupId(n):null,o||null==s||delete e.index,s=o&&null!=s&&l.$l.group?s:void 0,l.tabsCreate(e,r=>{if(l.Fl())return i&&i(),l.Fl();e.index=r.index,e.windowId=r.windowId,null!=s&&l.$l.group({tabIds:r.id,groupId:s}),i&&i(r),e.active=false;let o=null!=e.index,n=u?u.length:1,f=null!=s?e=>(e&&l.$l.group({tabIds:e.id,groupId:s}),l.Fl()):l.Fl;u.length>1&&(u[0]=e.url);for(let r=0;r<t;r++)for(let t=r>0?0:1;t<n;t++)u.length>1&&(e.url=u[t]),o&&++e.index,l.$l.create(e,f)},r)},l.makeWindow=(e,r,o)=>{let n=false!==e.focused;(r=r?"minimized"===r===n||"popup"===e.type||"normal"===r||"docked"===r?"":r:"")&&!r.includes("fullscreen")&&(e.state=r,r=""),e.focused=true;let i=e.url;i||null!=e.tabId||(i=e.url=t.Te.newTabUrl_f),"string"==typeof i&&u(i,e.incognito)&&delete e.url,l.Pl.create(e,r||!n||o?e=>{if(o&&o(e),!(r||!n)||!e)return l.Fl();let t=n?{}:{focused:false};r&&(t.state=r),l.Pl.update(e.id,t)}:l.Fl)},l.makeTempWindow_r=(e,t,r)=>{let u="number"==typeof e;l.Pl.create({type:"normal",focused:false,incognito:t,state:"minimized",tabId:u?e:void 0,url:u?void 0:e},r)},l.downloadFile=(e,t,u,o)=>{l.kl(l.Al.permissions.contains,{permissions:["downloads"]}).then(u=>{if(u){let u={url:e};if(t){let l=/\.[a-z\d]{1,4}(?=$|[?&])/i;if(t=(t="#"===(t=r.tt(t))[0]?t.slice(1):t).replace(/[\r\n]+/g," ").replace(/[/\\?%*:|"<>_]+/g,"_"),!l.test(t)){let r=l.exec(e);t+=r?r[0]:e.includes(".")?"":".bin"}u.filename=t}let n=l.kl(l.Al.downloads.download,u);o&&n.then(e=>o(void 0!==e))}else o&&o(false)})},l.removeTempTab=e=>{l.$l.remove(e,l.Fl)},l.xl=e=>(e=e.slice(0,99).toLowerCase(),1!==t.ve.get(e)&&(e.startsWith("about:")?"about:blank"!==e:e.startsWith("chrome:")?!e.startsWith("chrome://downloads"):e.startsWith(t.e.ll)&&!("string"!=typeof t.e.tl?t.e.tl.test(e):e.startsWith(t.e.tl))||t.He&&/^(edge|extension):/.test(e)&&!e.startsWith("edge://downloads"))),l.Il=(e,t)=>{let r=l.Al.permissions,u=Promise.all(e.map(e=>e&&l.kl(l.Al.permissions.contains,e))),o=e.map(e=>e&&(e.permissions||e.origins)[0]);u.then(e=>{let l=false,u=false,n=(n,f)=>{let a=!f;if(f){let l=f.permissions;for(let t of l||[]){let l=o.indexOf(t);l>=0&&(e[l]=n,a=true)}for(let t of(!l||l.length<=0)&&f.origins||[])if("chrome://*/*"!==t){let l=o.indexOf(t);l>=0&&(e[l]=n,a=true)}else for(let l=0;l<o.length;l++)(o[l]||"").startsWith("chrome://")&&(e[l]=n,a=true)}a&&(false===t(e,true)&&(l=u=false),l!==e.includes(false)&&r.onAdded[(l=!l)?"addListener":"removeListener"](i),u!==e.includes(true)&&r.onRemoved[(u=!u)?"addListener":"removeListener"](s))},i=n.bind(null,true),s=n.bind(null,false);e.includes(false)||e.includes(true)?n(true):t(e,false)})},l.vl=e=>{let r=location.origin.length;for(let u of t.e.il.slice(0,-1))l.$l.executeScript(e,{file:u.slice(r),allFrames:true},l.Fl)}});