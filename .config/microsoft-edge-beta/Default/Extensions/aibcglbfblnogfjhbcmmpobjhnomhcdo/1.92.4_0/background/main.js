"use strict";__filename="background/main.js",define(["require","exports","./store","./utils","./browser","./normalize_urls","./parse_urls","./settings","./ports","./exclusions","./ui_css","./key_mappings","./run_commands","./open_urls","./tools","./eval_urls","./all_commands","./request_handlers"],(e,t,r,o,n,s,a,l,i,u,_,c,m,d,p)=>{Object.defineProperty(t,"__esModule",{value:true}),o=__importStar(o),l=__importStar(l),u=__importStar(u);let f=e=>{let t=r.Pe.get(r.Ce);"quickNext"===e&&(e="nextTab");let o=c.ca;o&&o.get(e)?null==t||4&t.Zt||r.Ce<0?m.executeShortcut(e,t):n.tabsGet(r.Ce,t=>(m.executeShortcut(e,t&&"complete"===t.status?r.Pe.get(t.id):null),n.Fl())):o&&null!==o.get(e)&&(o.set(e,null),console.log("Shortcut %o has not been configured.",e))};gA={eo:l,ye:r.ye,Ye:r.Ye,Te:r.Te,dn:d.dn,E(){return r.E&&r.E()},to(){return{me:r.me,_e:r._e,ro:c.sa,pe:r.pe}},ve:r.ve,ke:r.ke,yt:s.yt,kt(){return s.kt},P:r.P,$t:s.$t,Ul:a.Ul,O(){return r.O&&r.O()},j:r.j,oo(e){return r.N.oo(e)},Vl:i.Vl,vn:d.vn,Bl:a.Bl,ii:u.ii,nn:_.nn,vl:n.vl,no(e,t){return null==e?r.Pe:null==t?-3===e?r.fe:r.Pe.get(e)||null:i.indexFrame(e,t)},so(){return r.Ce},Wt(){3===r.je&&(r.me||(l.Dt("keyMappings"),0===r.Ye.o&&(c.ea["m-s-c"]=36)),gA.Wt=null,l.Nt("hideHud",true),l.Nt("nextPatterns",true),l.Nt("previousPatterns",true),l.Dt("autoDarkMode"),l.Dt("autoReduceMotion"),n.Al.runtime.onConnect.addListener(e=>i.OnConnect(e,0|e.name)),n.Al.runtime.onConnectExternal.addListener(e=>{let t,{sender:o,name:n}=e;if(o&&i.isExtIdAllowed(o)&&n.startsWith("vimium-c.")&&(t=n.split("@")).length>1){if(t[1]!==r.e.GitVer)return e.postMessage({N:2,t:1}),void e.disconnect();i.OnConnect(e,32|t[0].slice(9))}else e.disconnect()}))},ao:p.cr.Er},n.Al.commands.onCommand.addListener(f),n.Al.runtime.onMessageExternal.addListener((e,t,o)=>{if(i.isExtIdAllowed(t))if("string"!=typeof e){if("object"==typeof e&&e)switch(e.handler){case"shortcut":let n=e.shortcut;n&&f(n+"");break;case"id":o({name:"Vimium C",host:location.host,shortcuts:true,injector:r.e._l,version:r.e.rl});break;case 99:o({s:e.scripts?r.e.il:null,version:r.e.rl,host:"",h:"@"+r.e.GitVer});break;case"command":m.executeExternalCmd(e,t)}}else m.executeExternalCmd({command:e},t);else o(false)}),l.Dt("extAllowList"),n.$l.onReplaced.addListener((e,t)=>{let o=r.Pe.get(t);if(o){r.Pe.delete(t),r.Pe.set(e,o);for(let t of o.Qt)t.s.Xl=e}}),l.Dt("vomnibarOptions"),l.Dt("vomnibarPage",null),l.Dt("searchUrl",null),r.N._n=(e,t,o)=>{setTimeout(()=>{r.N._n(e,t,o)},210)},r.D(2|r.je),gA.Wt(),setTimeout(()=>{setTimeout(()=>{new Promise((t,r)=>{e(["/background/browsing_data_manager.js"],t,r)}).then(__importStar),new Promise((t,r)=>{e(["/background/completion_utils.js"],t,r)}).then(__importStar),new Promise((t,r)=>{e(["/background/completion.js"],t,r)}).then(__importStar)},400),new Promise((t,r)=>{e(["/background/others.js"],t,r)}).then(__importStar),n.Al.extension.isAllowedIncognitoAccess(e=>{r.e.sl=false===e})},200),globalThis.onunload=e=>{if(!e||e.isTrusted){for(let e of r.fe)e.disconnect();r.Pe.forEach(e=>{for(let t of e.Qt.slice(0))t.disconnect()})}},globalThis.window||(globalThis.onclose=onunload)});