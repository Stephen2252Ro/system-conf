"use strict";__filename="background/filter_tabs.js",define(["require","exports","./store","./utils","./browser","./exclusions"],(e,l,t,r,i,u)=>{Object.defineProperty(l,"__esModule",{value:true}),l.oi=l.si=l.di=l.ai=l.fi=l.getTabRange=void 0,r=__importStar(r),u=__importStar(u),l.getTabRange=(e,l,r,i)=>{let u=t.cRepeat;i&&(u+=u>0?i:-i);let n=e+u,o=u>0;return n<=l&&n>-2?o?[e,n]:[n+1,e+1]:!t.get_cOptions().limited&&(Math.abs(u)<2*(r||l)||u<10)?Math.abs(u)<l?o?[l-u,l]:[0,-u]:[0,l]:o?[e,l]:[0,e+1]},l.fi=(e,r,u,n,o,s)=>{let d=n=>{if(!n||!n.length)return o(0),i.Fl();let s=i.selectFrom(n).index,[d,a]=l.getTabRange(s,n.length,0,r);u(n,e?[d,s,a]:[s+1===a||t.cRepeat>0&&d!==s?d:a-1,s,a],o)};n?0===n.length?i.getCurWnd(true,e=>d(e?e.tabs:[])):Math.abs(t.cRepeat)>1?d(n):r?n[0].index+t.cRepeat<0?i.ql(d):i.$l.query({windowId:n[0].windowId,index:n[0].index+t.cRepeat},e=>(e&&e.length&&i.Wl(e[0])&&(!s||s(e[0]))?u(e,[0,0,1],o):i.ql(d),i.Fl())):u(n,[0,0,1],o):o(0)},l.ai=()=>{let e=0,l=-1;return t.Ee.forEach((r,i)=>{r.i>e&&i!==t.Ce&&(e=r.i,l=i)}),l},l.di=(e,l)=>{1===Math.abs(e)?i.getCurTab(t=>{let r=t[0].index+e;r>=0?i.$l.query({windowId:t[0].windowId,index:r},r=>(r?l(e>0?[t[0],r[0]]:[r[0],t[0]]):i.getCurTabs(l),i.Fl())):i.getCurTabs(l)}):i.getCurTabs(l)},l.si=(e,l,t)=>{var n;let o,s,d,a,f=false;for(let l of(t+"").split(/[&+]/)){let t=l.split("=",1)[0],v=l.slice(t||"="===l[0]?t.length+1:0),h=v&&r.tt(v);if("title"===t||"title*"===t)o=h||e&&e.title||void 0;else if("url"===t||"hash"===t)if("url"===t&&h)s=u.ni(h);else{let l=e?i.getTabUrl(e):null;f=f||"hash"===t,s=l?u.ni(":"+(f?l:l.split("#",1)[0])):null}else if("host"!==t&&t){if("group"===t)a=h||(e?null!=i.getGroupId(e)?i.getGroupId(e)+"":null:void 0);else if(!(o||s||d||a))return[]}else d=h||(t&&e?null===(n=r.ot(i.getTabUrl(e)))||void 0===n?void 0:n.host:"")}return l.filter(e=>{var l,t;return(!o||(e.title||"").includes(o))&&(!s||u.ri(s,i.getTabUrl(e)))&&(!d||d===(null===(l=r.ot(i.getTabUrl(e)))||void 0===l?void 0:l.host))&&(void 0===a||a===(null!==(t=i.getGroupId(e))&&void 0!==t?t:"")+"")})},l.oi=(e,l)=>{let r,u=(e,l)=>{e.index=l},n=(e,l)=>e<l?-1:e>l?1:0,o=e.map((e,l)=>({tab:e,index:l,time:null,rhost:null,group:i.getGroupId(e)})),s=-1,d=false;for(let e of(l instanceof Array?l.slice(0):(true===l?"time":l+"").split(/[, ]+/g)).reverse())r="r"===e[0]?-1:1,e.includes("time")&&!e.includes("creat")||e.includes("recen")?(null==o[0].time&&o.forEach(e=>{let l=e.tab.id,r=t.Ee.get(l);e.time=l===t.Ce?1:null!=r?2047-r.i:l+2}),r="r"===e[0]&&"e"!==e[1]?-1:1,s=1):e.endsWith("host")||e.endsWith("url")?(o[0].rhost||o.forEach(e=>{let l=e.tab.url,t=l.indexOf("://")+3,r=t>3?l.indexOf("/",t):0;if(r<t)return void(e.rhost=l);let i=l.slice(t,r),u=i.lastIndexOf(":"),n=u>0&&i.lastIndexOf(":",u-1)>0;e.rhost=n?i:i.slice(0,u>0?u:i.length).split(".").reverse().join(".")+(u>0?" "+i.slice(1):"")}),s=e.includes("url")?3:2):s="title"===e?4:e.includes("creat")||"id"===e?5:e.includes("window")?6:e.includes("index")||"reverse"===e?7:-1,s<0||(o.sort((e,l)=>(1===s?e.time-l.time:s<4?n(e.rhost,l.rhost)||(3===s?n(e.tab.url,l.tab.url):0):4===s?n(e.tab.title,l.tab.title):5===s?e.tab.id-l.tab.id:6===s?e.tab.windowId-l.tab.windowId:e.index-l.index)*r||e.index-l.index),o.forEach(u),d=true);return d&&o.some(e=>null!=e.group)&&o.sort((e,l)=>null==e.group?null==l.group?e.index-l.index:1:null==l.group||e.group<l.group?-1:e.group>l.group?1:e.index-l.index),d?o.map(e=>e.tab):e}});